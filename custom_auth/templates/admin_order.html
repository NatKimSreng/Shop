{% extends 'sidebar.html' %}
{% load static %}
{% block content %}

<style>
  body { color: black; }
  .card, .alert, .form-control, .form-select, .table, .btn {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    color: white;
  }
  .btn-primary { background: linear-gradient(to right, #667eea, #764ba2); color: white; border: none; }
  .table th, .table td { color: white; }
  .status-form select { font-size: 0.8rem; }
    * {
    color: #000 !important;
  }
</style>

<div class="container py-4">
  <h1 class="mb-4">Order Management</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="card mb-4">
    <div class="card-header">Filters</div>
    <div class="card-body">
      <form method="GET" class="row g-3">
        <div class="col-md-3">
          <label>Brand</label>
          <select name="brand" class="form-select">
            <option value="">All</option>
            {% for brand in target_brands %}
              <option value="{{ brand }}" {% if brand == selected_brand %}selected{% endif %}>{{ brand }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-3">
          <label>Status</label>
          <select name="status" class="form-select">
            <option value="">All</option>
            <option value="PENDING" {% if selected_status == 'PENDING' %}selected{% endif %}>Pending</option>
            <option value="SHIPPED" {% if selected_status == 'SHIPPED' %}selected{% endif %}>Shipped</option>
            <option value="DELIVERED" {% if selected_status == 'DELIVERED' %}selected{% endif %}>Delivered</option>
            <option value="CANCELLED" {% if selected_status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
          </select>
        </div>
        <div class="col-md-3">
          <label>Payment</label>
          <select name="payment" class="form-select">
            <option value="">All</option>
            <option value="cod" {% if selected_payment == 'cod' %}selected{% endif %}>COD</option>
            <option value="bank_transfer" {% if selected_payment == 'bank_transfer' %}selected{% endif %}>Bank Transfer</option>
          </select>
        </div>
        <div class="col-md-3">
          <label>Date</label>
          <select name="date" class="form-select">
            <option value="">Any</option>
            <option value="today" {% if selected_date == 'today' %}selected{% endif %}>Today</option>
            <option value="past_7_days" {% if selected_date == 'past_7_days' %}selected{% endif %}>Past 7 Days</option>
            <option value="this_month" {% if selected_date == 'this_month' %}selected{% endif %}>This Month</option>
            <option value="this_year" {% if selected_date == 'this_year' %}selected{% endif %}>This Year</option>
          </select>
        </div>
        <div class="col-12 text-end">
          <button type="submit" class="btn btn-primary">Apply</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Orders</div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Customer</th>
              <th>Amount</th>
              <th>Payment</th>
              <th>Status</th>
              <th>Date</th>
              <th>Address</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for order in orders %}
              <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.user.username|default:order.shipping_address.shipping_full_name }}</td>
                <td>${{ order.amount_paid|floatformat:2 }}</td>
                <td>{{ order.payment_method|title }}</td>
                <td>
                  <form method="POST" action="{% url 'admin_order_update_status' order.id %}" class="status-form">
                    {% csrf_token %}
                    <select name="status" class="form-select">
                      <option value="PENDING" {% if order.status == 'PENDING' %}selected{% endif %}>Pending</option>
                      <option value="SHIPPED" {% if order.status == 'SHIPPED' %}selected{% endif %}>Shipped</option>
                      <option value="DELIVERED" {% if order.status == 'DELIVERED' %}selected{% endif %}>Delivered</option>
                      <option value="CANCELLED" {% if order.status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
                    </select>
                    <button class="btn btn-sm btn-primary">Save</button>
                  </form>
                </td>
                <td>{{ order.date_ordered|date:"M d, Y H:i" }}</td>
                <td>{{ order.shipping_address.get_full_address|truncatechars:40 }}</td>
                <td><a href="{% url 'admin_order_detail' order.id %}" class="btn btn-sm btn-primary">View</a></td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="8" class="text-center">No orders found.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{% endblock content %}