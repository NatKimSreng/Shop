{% extends 'sidebar.html' %}
{% load static template_tags %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Admin Dashboard</h1>
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <!-- Navigation -->
  <div class="mb-4">
    <a href="{% url 'admin_order_list' %}" class="btn btn-primary">View All Orders</a>
    <a href="{% url 'admin_product_list' %}" class="btn btn-secondary">Manage Products</a>
  </div>
  
  <!-- Product Prices and Sales Table -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Product Prices and Sales</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Brand/Category</th>
              <th>Product Name</th>
              <th>Price</th>
              <th>Sale Price</th>
              <th>In Stock</th>
              <th>Amount Paid</th>
            </tr>
          </thead>
          <tbody>
            {% for item in product_sales %}
            <tr>
              <td>{{ item.category }}</td>
              <td>{{ item.product.name }}</td>
              <td>${{ item.price|floatformat:2 }}</td>
              <td>${{ item.sale_price|floatformat:2 }}</td>
              <td>
                {% if item.is_sale %}
                <span class="badge bg-success">In Stock</span>
                {% else %}
                <span class="badge bg-danger">Out of Stock</span>
                {% endif %}
              </td>
              <td>${{ item.amount_paid|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center">No products found for selected brands.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <!-- Sales by Brand Chart -->
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Total Sales by Brand</h5>
    </div>
    <div class="card-body">
      <canvas id="salesChart" style="max-height: 400px;"></canvas>
    </div>
  </div>
</div>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.min.js"></script>
<script>
  const ctx = document.getElementById('salesChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ target_brands|safe }},
      datasets: [{
        label: 'Total Sales ($)',
        data: [
          {% for brand in target_brands %}
          {{ sales_by_brand|get_item:brand|default:0 }},
          {% endfor %}
        ],
        backgroundColor: [
          '#0d6efd', '#6c757d', '#198754', '#dc3545', '#ffc107', '#0dcaf0'
        ],
        borderColor: '#ffffff',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { position: 'top' },
        title: { display: true, text: 'Sales by Brand' }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Total Sales ($)' }
        }
      }
    }
  });
</script>

<style>
  .card { border: none; border-radius: 8px; }
  .table th, .table td { vertical-align: middle; }
  .alert { border-radius: 4px; }
</style>
{% endblock content %}