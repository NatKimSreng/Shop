{% extends 'sidebar.html' %}
{% load static %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">Order Details - #{{ order.id }}</h1>
  {% if messages %}
    <div class="mb-3">
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
  
  <!-- Order Summary -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Order Summary</h5>
    </div>
    <div class="card-body">
      <form method="POST">
        {% csrf_token %}
        <div class="mb-3">
          <label for="status" class="form-label">Status</label>
          <select name="status" id="status" class="form-select">
            <option value="PENDING" {% if order.status == 'PENDING' %}selected{% endif %}>Pending</option>
            <option value="SHIPPED" {% if order.status == 'SHIPPED' %}selected{% endif %}>Shipped</option>
            <option value="DELIVERED" {% if order.status == 'DELIVERED' %}selected{% endif %}>Delivered</option>
            <option value="CANCELLED" {% if order.status == 'CANCELLED' %}selected{% endif %}>Cancelled</option>
          </select>
        </div>
        <button type="submit" class update-status="btn btn-primary">Update Status</button>
      </form>
      <hr>
      <p><strong>Customer:</strong> 
        {% if order.user %}
          {{ order.user.username }}
        {% elif order.user.shipping_address %}
          {{ order.user.shipping_address.shipping_full_name }}
        {% else %}
          N/A
        {% endif %}
      </p>
      <p><strong>Total Amount:</strong> ${{ order.amount_paid|floatformat:2 }}</p>
      <p><strong>Payment Method:</strong> 
        {% if order.payment_method == 'cod' %}
          Pay on Delivery
        {% elif order.payment_method == 'bank_transfer' %}
          Bank Transfer
        {% else %}
          {{ order.payment_method }}
        {% endif %}
      </p>
      <p><strong>Date Ordered:</strong> {{ order.date_ordered|date:"Y-m-d H:i" }}</p>
      <p><strong>Shipping Address:</strong> 
        {% if order.shipping_address %}
          {{ order.shipping_address.get_full_address }}
        {% else %}
          <span>N/A</span>
        {% endif %}
      </p>
      <p><strong>Delivery Option:</strong> 
        {% if order.delivery_option %}
          {{ order.delivery_option.name }} (${{ order.delivery_option.price|floatformat:2 }})
        {% else %}
          N/A
        {% endif %}
      </p>
    </div>
  </div>
  
  <!-- Order Items -->
  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Order Items</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Product</th>
              <th>Order Quantity</th>
              <th>Price</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr>
              <td>{{ item.product.name }}</td>
              <td>{{ item.quantity }}</td>
              <td>${{ item.price|floatformat:2 }}</td>
              <td>${{ item.get_total|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center">No items found in this order.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <a href="{% url 'admin_order_list' %}" style="btn btn-primary" class="btn btn-secondary mt-3">Back to Orders</a>
</div>

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  .card { border: none; border-radius: 8px; }
  .table th, .table td { vertical-align: middle; }
  .alert { border-radius: 4px; }
</style>
{% endblock content %}
